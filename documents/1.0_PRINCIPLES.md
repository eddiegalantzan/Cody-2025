# Project Principles

Single source of truth for all project principles. Reference this file, don't duplicate.

## DRY (Strictly Enforced)

**Core Rules:** No code duplication - Extract to `src/shared`. No CSS duplication - Global DRY CSS in `src/global.css` only. Never copy-paste - Always import from shared modules.

### When to Extract

- **Utility Function:** Logic appears 3+ times, is complex/reusable, or used across components
- **Shared Type:** Type definition appears in 2+ files or represents common domain concept
- **Hook:** State pattern appears in 2+ components or is complex enough to isolate
- **Constant:** Value appears in 2+ places, might change, or is configuration-related

### Patterns

- **Extract Common Logic:** When logic appears 3+ times → `src/shared/utils/`
- **Shared Constants:** Store in `src/shared/single-source.ts` (cache configs, timeouts, limits)
- **Repeated Conditionals:** Extract to named variables/functions
- **Shared Types:** Common UI types → `src/shared/types/ui/common.ts`
- **Backend:** Generate SQL WHERE clauses in service layer, not queries

### Recommended Utilities (create as needed)

- `src/shared/utils/filterUtils.ts` - Filter options, handlers, query builders
- `src/shared/utils/csvUtils.ts` - CSV escaping, generation, formatting
- `src/shared/utils/dateUtils.ts` - Date validation, formatting, ranges
- `src/shared/utils/formatters.ts` - Entity names, numbers, percentages
- `src/shared/utils/trpcUtils.ts` - Cache configs, query builders, result extraction
- `src/shared/hooks/` - `useModalState<T>()` and other reusable state patterns

**Note:** Create utilities when pattern emerges naturally, not in advance.

### Quick Reference

- Date validation: `isValidDateRange()` from date utils
- Cache config: Constants from `src/shared/single-source.ts` (`CACHE_STANDARD`, `CACHE_NONE`)
- tRPC results: `extractResultData()` helper
- Entity names: Formatting utilities
- Filters: Filter utilities
- CSV export: CSV utilities
- Modal state: `useModalState<T>()` hook
- Backend filtering: SQL WHERE clauses in service layer

### File Structure

- `src/shared/utils/` - Utility functions
- `src/shared/types/ui/` - Common UI types/enums
- `src/shared/hooks/` - Reusable React hooks
- `src/shared/single-source.ts` - Configuration constants
- Backend: Base service classes for CRUD, SQL generation in service methods
- Frontend: Shared components, hooks, filter/form utilities

### Examples

```typescript
// ❌ Bad: Duplicated logic
const isValid = startDate && endDate && startDate <= endDate;

// ✅ Good: Extract to utility
// src/shared/utils/dateUtils.ts
export const isValidDateRange = (start: Date | null, end: Date | null): boolean => {
  return !!(start && end && start <= end);
};

// ❌ Bad: Magic numbers
const cacheTime = 300000;

// ✅ Good: Shared constants
// src/shared/single-source.ts
export const CACHE_STANDARD = 300000; // 5 minutes
```

### Anti-Patterns

- ❌ Don't create empty utility files before pattern emerges
- ❌ Don't over-abstract single-use functions
- ❌ Don't duplicate type definitions (move to `src/shared/types/` if used in 2+ files)
- ❌ Don't hardcode values (use constants from `src/shared/single-source.ts`)
- ❌ Don't copy-paste code (extract immediately)

## Single Source of Truth
- **Data:** `db/init.sql` - All schema/data definitions (to be created)
- **Config:** `src/shared/single-source.ts` - All configuration values (to be created)

## TypeScript
- `strict` mode
- No `any` or `unknown` types
- `@ts-expect-error` only in wrapper files (with explanation)

## Naming & Self-Documentation
- **Code is self-documenting:** Variable and function names should be clear without comments
- **No short names:** Use full descriptive names (e.g., `userProfile` not `usr`, `calculateTotalPrice` not `calc`)
- **Variables:** Must be understood without explanation (e.g., `isUserAuthenticated` not `auth`, `selectedCustomerId` not `id`)
- **Functions:** Use descriptive verb-noun patterns (e.g., `validateEmailAddress`, `fetchUserProfile`, `calculateOrderTotal`)
- **Comments explain why, not what:** Code should be clear enough that comments only explain reasoning/context

## Styling
- Global DRY CSS in `src/global.css` only
- Module CSS prohibited
- Low specificity, semantic class names

## Architecture
- tRPC for client↔server
- Direct SQL queries (no ORM)
- Shared code in `src/shared`

---

## Related Documentation

- [2.0_PROJECT_RULES.md](./2.0_PROJECT_RULES.md) - Complete project rules
- [5.0_PLAN.md](./5.0_PLAN.md) - Project plan
- [9.0_INTEGRATIONS.md](./9.0_INTEGRATIONS.md) - Third-party integrations (Clerk, Payoneer, Mailgun, WhatsApp)
