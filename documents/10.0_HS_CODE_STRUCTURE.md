# HS Code Structure and Country-Specific Implementations

## ⚠️ IMPORTANT: Verification Required

**This document contains information that needs verification from official sources.** Some details are based on general knowledge and may not be accurate for all countries. Please verify all information with official customs authorities before implementation.

## Overview

The Harmonized System (HS) is an internationally standardized system for classifying traded products, developed and maintained by the World Customs Organization (WCO). This document describes the HS code structure, WCO hierarchy, and country-specific implementations for the initial focus countries.

**Status**: This is a working document. Information marked with ⚠️ needs verification.

## WCO HS Nomenclature Structure

The WCO HS Nomenclature follows a hierarchical structure:

### 1. WCO Editions
- **Purpose**: Different versions of the HS Nomenclature (e.g., 2022, 2017, 2012)
- **Updates**: WCO releases new editions approximately every 5-7 years
- **Current**: HS 2022 Edition (effective January 1, 2022)
- **Database Field**: `wco_editions` table

### 2. WCO Sections
- **Range**: I through XXI (21 sections total)
- **Purpose**: Broad product categories
- **Example**: Section I = "LIVE ANIMALS; ANIMAL PRODUCTS"
- **Database Field**: `wco_sections` table
- **Structure**: Each section belongs to a WCO Edition

### 3. WCO Chapters
- **Range**: 1 through 97 (97 chapters total)
- **Purpose**: More specific product categories within sections
- **Example**: Chapter 1 = "Live animals"
- **Database Field**: `wco_chapters` table
- **Structure**: Each chapter belongs to a WCO Section

### 4. WCO Headings
- **Format**: 4-digit codes without dots (e.g., 0101, 0102, 0103)
- **Purpose**: Specific product categories within chapters
- **Example**: Heading 0101 = "Live horses, asses, mules and hinnies" (stored as "0101", not "01.01")
- **Database Field**: `wco_headings` table
- **Structure**: Each heading belongs to a WCO Chapter
- **Reference**: [WCO HS Nomenclature 2022 - Chapter 1 Example](https://www.wcoomd.org/-/media/wco/public/global/pdf/topics/nomenclature/instruments-and-tools/hs-nomenclature-2022/2022/0101_2022e.pdf?la=en)

### 5. WCO HS Codes (6-digit)
- **Format**: 6-digit codes (e.g., 010121, 010129)
- **Purpose**: Most specific international classification level
- **Structure**: 
  - First 2 digits: Chapter number
  - Next 2 digits: Heading number
  - Last 2 digits: Subheading
- **Example**: 
  - 010121 = "Pure-bred breeding animals" (horses)
  - 010129 = "Other" (horses)
- **Database Field**: `wco_hs_codes` table
- **Check Digit**: Some countries may add a 7th digit as a check digit (optional)

## Country-Specific Extensions

Countries extend the WCO 6-digit codes to meet their specific classification needs. The first 6 digits always match the WCO standard, while additional digits are country-specific.

### General Structure
- **Digits 1-6**: WCO standard (international)
- **Digits 7-8**: Country-specific classification
- **Digits 9-10**: Additional country-specific detail (statistical, regulatory, etc.)
- **Digit 11**: Optional check digit (some countries)

## Focus Countries: HS Code Structure

### European Union (EU)

**Code Format**: 10-digit TARIC (Integrated Tariff of the European Communities)

**Structure**:
- **Digits 1-6**: WCO HS code (international standard)
- **Digits 7-8**: Combined Nomenclature (CN) codes (EU-specific)
- **Digits 9-10**: TARIC codes (additional EU regulations, quotas, licenses)
- **Check Digit**: No check digit

**Notes**:
- TARIC = Tarif Intégré de la Communauté
- Used by all EU member states
- Includes additional regulatory information beyond basic classification
- Updated regularly to reflect EU trade policies

**Example**: `0305410010`
- `030541` = WCO HS code (smoked Pacific salmon)
- `00` = CN code
- `10` = TARIC code (specific EU classification)

**Database Implementation**:
- Store in `customs_book_hs_codes` table
- Link to WCO code via `customs_book_hs_code_wco_hs_code_fk`
- Country: EU member states (Germany, France, Italy, Spain, etc.)

---

### United Kingdom (UK)

**Code Format**: 10-digit UK Trade Tariff

**Structure**:
- **Digits 1-6**: WCO HS code (international standard)
- **Digits 7-8**: Combined Nomenclature (CN) codes (inherited from EU, now UK-specific)
- **Digits 9-10**: UK national subdivision (statistical, regulatory)
- **Check Digit**: No check digit

**Notes**:
- Post-Brexit: UK maintains similar structure to EU but with UK-specific regulations
- UK Trade Tariff is maintained by HM Revenue & Customs (HMRC)
- Similar to EU TARIC but with UK-specific rules

**Example**: `0305410010`
- `030541` = WCO HS code
- `00` = CN code
- `10` = UK national subdivision

**Database Implementation**:
- Store in `customs_book_hs_codes` table
- Country: UK (GB)

---

### United States of America (USA)

**Code Format**: 10-digit HTSUS (Harmonized Tariff Schedule of the United States)

**Structure**:
- **Digits 1-6**: WCO HS code (international standard)
- **Digits 7-10**: USA-specific classification
  - Digits 7-8: USA statistical suffix
  - Digits 9-10: USA tariff rate line item
- **Check Digit**: No check digit

**Notes**:
- Maintained by U.S. International Trade Commission (USITC)
- Used for imports
- Schedule B codes (10-digit) used for exports
- Very detailed classification for trade statistics and tariff purposes

**Example**: `0305410000`
- `030541` = WCO HS code
- `0000` = USA-specific classification

**Database Implementation**:
- Store in `customs_book_hs_codes` table
- Country: USA (US)

---

### Israel

**Code Format**: 8-digit Israeli Customs Tariff + Check Digit (9 digits total)

**Structure**:
- **Digits 1-6**: WCO HS code (international standard)
- **Digits 7-8**: Israeli-specific classification
- **Digit 9**: Check digit (for validation)

**Check Digit**: ✅ **YES - Israel uses check digits**
- ⚠️ **VERIFY**: Check digit calculation algorithm (may be country-specific)
- Check digit is used for validation and error detection
- Calculation method needs to be verified with Israel Tax Authority

**Notes**:
- Maintained by Israel Tax Authority
- Israel has 3 customs books (verify exact structure)
- Used for import/export classification
- Includes purchase tax information
- ⚠️ **VERIFY**: Exact structure of all 3 customs books
- ⚠️ **VERIFY**: Check digit calculation algorithm

**Example**: `030541001` (with check digit)
- `030541` = WCO HS code
- `00` = Israeli-specific classification
- `1` = Check digit (example, verify calculation)

**Database Implementation**:
- Store in `customs_book_hs_codes` table
- Country: Israel (IL)
- Code length: 9 digits (8 + check digit)
- **Important**: Verify all 3 customs books and their specific structures
- **Important**: Implement check digit validation algorithm

---

### Canada

**Code Format**: 10-digit Canadian Customs Tariff

**Structure**:
- **Digits 1-6**: WCO HS code (international standard)
- **Digits 7-10**: Canadian-specific classification
  - Digits 7-8: Canadian statistical suffix
  - Digits 9-10: Canadian tariff classification
- **Check Digit**: No check digit

**Notes**:
- Maintained by Canada Border Services Agency (CBSA)
- Used for imports
- Export codes may use 8 digits
- Aligned with USA structure for North American trade

**Example**: `0305410000`
- `030541` = WCO HS code
- `0000` = Canadian-specific classification

**Database Implementation**:
- Store in `customs_book_hs_codes` table
- Country: Canada (CA)

---

### Mexico

**Code Format**: 10-digit Mexican Tariff Schedule (as of December 28, 2020)

**Structure**:
- **Digits 1-6**: WCO HS code (international standard)
- **Digits 7-10**: Mexican-specific classification
- **Check Digit**: No check digit

**Notes**:
- Updated in 2020 from 8-digit to 10-digit format
- Aligned with USA and Canada for North American trade
- Maintained by Servicio de Administración Tributaria (SAT)
- Used for import/export classification

**Example**: `0305410000`
- `030541` = WCO HS code
- `0000` = Mexican-specific classification

**Database Implementation**:
- Store in `customs_book_hs_codes` table
- Country: Mexico (MX)

---

## Check Digits

### Overview
A check digit is an additional digit used to verify the accuracy of a code through mathematical validation. **Check digits are used by some countries, and the calculation algorithm may vary by country.**

### ⚠️ Important Notes
- **Check digit algorithms are country-specific** - Each country may use a different calculation method
- **Must verify** the exact algorithm for each country that uses check digits
- **Cannot assume** all countries use the same calculation method

### Current Status by Country (Based on Research)

- **EU**: ❌ **NO** - EU TARIC codes (10 digits) do not use check digits
- **UK**: ❌ **NO** - UK Trade Tariff codes (10 digits) do not use check digits
- **USA**: ❌ **NO** - USA HTSUS codes (10 digits) do not use check digits
- **Israel**: ✅ **YES - Uses check digit** (9th digit for 8-digit codes)
  - ⚠️ **VERIFY**: Check digit calculation algorithm (not found in public sources)
  - **Source**: Multiple sources confirm Israel uses check digits, but algorithm not publicly documented
- **Canada**: ❌ **NO** - Canada customs codes (10 digits) do not use check digits
- **Mexico**: ❌ **NO** - Mexico customs codes (10 digits) do not use check digits

**Note**: Check digit algorithms are typically not publicly documented and may require direct contact with customs authorities.

### Database Support
The database schema supports check digits:
- **WCO HS Codes**: `VARCHAR(7)` - supports 6 digits + optional check digit (7 digits)
- **Customs Book HS Codes**: `VARCHAR(20)` - supports 8-11 digits (including optional check digit)
- **Classification Results**: `VARCHAR(20)` - supports 7-11 digits (including optional check digit)

### Check Digit Lengths
If a country implements check digits:
- **6-digit WCO codes** → **7 digits** (with check digit)
- **8-digit country codes** → **9 digits** (with check digit) - **Israel confirmed**
- **10-digit country codes** → **11 digits** (with check digit)

### Implementation Requirements
For each country that uses check digits:
1. **Verify** if check digits are used
2. **Document** the check digit calculation algorithm
3. **Store** algorithm in `customs_books.customs_book_checksum_algorithm` field
4. **Implement** validation function for check digit verification
5. **Test** with real examples from official sources

### Database Storage
The `customs_books` table includes a `customs_book_checksum_algorithm` field:
- **Type**: TEXT (nullable)
- **Format**: JSON or text description of the calculation method
- **NULL**: For countries that don't use check digits (EU, UK, USA, Canada, Mexico)
- **Value**: Algorithm description for countries that use check digits (e.g., Israel)

**Example Algorithm Format** (when known):
```json
{
  "type": "modulo",
  "divisor": 10,
  "weights": [1, 2, 3, 4, 5, 6, 7, 8],
  "position": 9,
  "description": "Multiply each digit by weight, sum, modulo 10"
}
```

---

## Database Schema Implementation

### WCO Structure Tables
1. **`wco_editions`** - HS Nomenclature editions (2022, 2017, etc.)
2. **`wco_sections`** - Sections I-XXI
3. **`wco_chapters`** - Chapters 1-97
4. **`wco_headings`** - 4-digit headings without dots (e.g., 0101, 0102)
5. **`wco_hs_codes`** - 6-digit (or 7 with check digit) international codes

### Country-Specific Tables
1. **`countries`** - Country reference data
2. **`customs_books`** - Country-specific customs tariff books
   - **`customs_book_checksum_algorithm`**: Stores check digit/checksum calculation algorithm (NULL if not used)
   - Algorithm stored as TEXT (JSON or description format)
   - NULL for countries that don't use check digits
3. **`customs_book_hs_codes`** - Country-specific HS codes (8-11 digits)

### Relationships
```
wco_editions
  └── wco_sections
      └── wco_chapters
          └── wco_headings
              └── wco_hs_codes (6-digit)
                  └── customs_book_hs_codes (8-11 digits, country-specific)
```

### Key Design Decisions
1. **No direct link from customs_books to wco_editions**: A customs book may contain codes from different WCO editions
2. **Optional WCO link in customs_book_hs_codes**: Some countries create codes that don't exist in WCO
3. **Flexible code length**: VARCHAR(20) supports all country variations including check digits
4. **WCO edition determined through hierarchy**: `customs_book_hs_codes` → `wco_hs_codes` → `wco_headings` → `wco_chapters` → `wco_sections` → `wco_editions`

---

## Country Summary Table

| Country | Code Length | Structure | Check Digit | Verification Status |
|---------|-------------|-----------|-------------|---------------------|
| **EU** | 10 digits | 6 WCO + 2 CN + 2 TARIC | ❌ **NO** | ✅ Verified (no check digit) |
| **UK** | 10 digits | 6 WCO + 2 CN + 2 UK | ❌ **NO** | ✅ Verified (no check digit) |
| **USA** | 10 digits | 6 WCO + 4 USA | ❌ **NO** | ✅ Verified (no check digit) |
| **Israel** | 9 digits | 6 WCO + 2 IL + 1 check | ✅ **YES** | ⚠️ Algorithm not found |
| **Canada** | 10 digits | 6 WCO + 4 CA | ❌ **NO** | ✅ Verified (no check digit) |
| **Mexico** | 10 digits | 6 WCO + 4 MX | ❌ **NO** | ✅ Verified (no check digit) |

**Legend**:
- ✅ = Confirmed
- ❌ = Confirmed (not used)
- ⚠️ = Needs verification

**Research Summary**:
- ✅ **Verified**: EU, UK, USA, Canada, Mexico do NOT use check digits
- ✅ **Confirmed**: Israel uses check digits (9th digit)
- ⚠️ **Missing**: Israel check digit calculation algorithm (not publicly documented)

---

## Next Steps - Verification Required

### High Priority
1. **Israel Check Digit Algorithm**: 
   - ⚠️ **URGENT**: Verify and document the exact check digit calculation algorithm
   - **Status**: Confirmed Israel uses check digits, but algorithm not found in public sources
   - **Action Required**: Contact Israel Tax Authority directly for algorithm documentation
   - Test with real examples from Israel Tax Authority
   - Implement validation function once algorithm is obtained

2. **Israel Customs Books**: 
   - ⚠️ **URGENT**: Verify the exact structure of all 3 Israeli customs books
   - **Status**: Information about 3 books structure not found in public sources
   - **Action Required**: Contact Israel Tax Authority or review official documentation
   - Confirm if all 3 books use the same structure
   - Document any differences between the books

3. **Other Countries Check Digits**: 
   - ✅ **COMPLETED**: Verified that EU, UK, USA, Canada, Mexico do NOT use check digits
   - No further action needed for these countries

### Medium Priority
4. **EU Member States**: Determine which specific EU countries to support initially
5. **Data Sources**: Identify official sources for each country's customs tariff data
6. **Validation Rules**: Implement country-specific validation rules for HS codes
7. **Code Structure Verification**: Verify the exact structure for each country with official sources

### Implementation
8. **Check Digit Validation**: Implement validation functions for each country that uses check digits
9. **Error Handling**: Handle invalid check digits appropriately
10. **Testing**: Test with real examples from official sources

---

## References

- [WCO HS Nomenclature 2022 Edition](https://www.wcoomd.org/en/topics/nomenclature/instrument-and-tools/hs-nomenclature-2022-edition/hs-nomenclature-2022-edition.aspx)
- [WCO HS Nomenclature Structure Example - Chapter 1](https://www.wcoomd.org/-/media/wco/public/global/pdf/topics/nomenclature/instruments-and-tools/hs-nomenclature-2022/2022/0101_2022e.pdf?la=en)
- [USA Trade.gov - HS Codes](https://www.trade.gov/harmonized-system-hs-codes)
- [UK Trade Tariff - HMRC](https://www.gov.uk/trade-tariff)
- [Israel Tax Authority - Customs Tariff](https://www.gov.il/en/service/customs-tariff)

---

## Document Version

- **Created**: 2025-01-XX
- **Last Updated**: 2025-01-XX
- **Status**: ⚠️ **WORKING DOCUMENT - Verification Required**
- **Accuracy**: Some information needs verification from official sources
- **Next Review**: After verifying check digit algorithms and country-specific structures

## Known Issues / Verification Needed

1. ⚠️ **Israel Check Digit Algorithm**: 
   - ✅ Confirmed that Israel uses check digits (9th digit)
   - ❌ Calculation algorithm NOT found in public sources
   - **Action**: Contact Israel Tax Authority directly for algorithm documentation

2. ✅ **Other Countries Check Digits**: 
   - Verified: EU, UK, USA, Canada, Mexico do NOT use check digits
   - No further verification needed

3. ⚠️ **Check Digit Algorithms**: 
   - Israel's algorithm needs to be obtained from official source
   - Algorithm is likely not publicly documented (common for security/validation purposes)

4. ⚠️ **Country Structures**: 
   - Basic structure verified from multiple sources
   - Some details may need refinement with official documentation

5. ⚠️ **Israel Customs Books**: 
   - Information about 3 customs books structure not found in public sources
   - **Action**: Contact Israel Tax Authority or review official documentation

## Action Items

- [x] Verify if other countries use check digits (EU, UK, USA, Canada, Mexico) - **COMPLETED: None use check digits**
- [ ] **URGENT**: Obtain Israel check digit calculation algorithm from Israel Tax Authority
- [ ] **URGENT**: Verify exact structure of Israel's 3 customs books from official source
- [ ] Document Israel check digit algorithm once obtained
- [ ] Implement check digit validation function for Israel
- [ ] Test validation with real examples from Israel Tax Authority

